# å®è·µç»ƒä¹ ï¼šé«˜çº§æ·±åº¦å¼ºåŒ–å­¦ä¹ ã€‚ä½¿ç”¨Sample Factoryä»åƒç´ çº§åˆ«ç©Doomæ¸¸æˆ

<CourseFloatingBanner classNames="absolute z-10 right-0 top-0"
notebooks={[
  {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/deep-rl-class/blob/main/notebooks/unit8/unit8_part2.ipynb"}
  ]}
  askForHelpUrl="http://hf.co/join/discord" />

Colabç¬”è®°æœ¬ï¼š
[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/huggingface/deep-rl-class/blob/master/notebooks/unit8/unit8_part2.ipynb)

# å•å…ƒ8 ç¬¬2éƒ¨åˆ†ï¼šé«˜çº§æ·±åº¦å¼ºåŒ–å­¦ä¹ ã€‚ä½¿ç”¨Sample Factoryä»åƒç´ çº§åˆ«ç©Doomæ¸¸æˆ

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit9/thumbnail2.png" alt="Thumbnail"/>

åœ¨æœ¬ç¬”è®°æœ¬ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è®­ç»ƒä¸€ä¸ªæ·±åº¦ç¥ç»ç½‘ç»œï¼Œåœ¨åŸºäºDoomæ¸¸æˆçš„3Dç¯å¢ƒä¸­æ”¶é›†ç‰©å“ï¼Œä¸‹é¢å±•ç¤ºäº†æœ€ç»ˆç­–ç•¥çš„è§†é¢‘ã€‚æˆ‘ä»¬ä½¿ç”¨[Sample Factory](https://www.samplefactory.dev/)ï¼ˆPPOç®—æ³•çš„å¼‚æ­¥å®ç°ï¼‰æ¥è®­ç»ƒè¿™ä¸ªç­–ç•¥ã€‚

è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

*   [Sample Factory](https://www.samplefactory.dev/)æ˜¯ä¸€ä¸ªé«˜çº§å¼ºåŒ–å­¦ä¹ æ¡†æ¶ï¼Œ**ä»…åœ¨Linuxå’ŒMacä¸Šè¿è¡Œ**ï¼ˆä¸æ”¯æŒWindowsï¼‰ã€‚

*  è¯¥æ¡†æ¶åœ¨**å…·æœ‰å¤šä¸ªCPUæ ¸å¿ƒçš„GPUæœºå™¨**ä¸Šè¡¨ç°æœ€ä½³ï¼Œå¯ä»¥è¾¾åˆ°æ¯ç§’10ä¸‡æ¬¡äº¤äº’çš„é€Ÿåº¦ã€‚æ ‡å‡†Colabç¬”è®°æœ¬ä¸Šå¯ç”¨çš„èµ„æº**é™åˆ¶äº†è¿™ä¸ªåº“çš„æ€§èƒ½**ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§è®¾ç½®ä¸‹çš„é€Ÿåº¦**å¹¶ä¸åæ˜ çœŸå®ä¸–ç•Œçš„æ€§èƒ½**ã€‚
* Sample Factoryçš„åŸºå‡†æµ‹è¯•åœ¨å¤šç§è®¾ç½®ä¸­éƒ½æœ‰æä¾›ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¯·æŸ¥çœ‹[ç¤ºä¾‹](https://github.com/alex-petrenko/sample-factory/tree/master/sf_examples)ã€‚


```python
from IPython.display import HTML

HTML(
    """<video width="640" height="480" controls>
  <source src="https://huggingface.co/edbeeching/doom_health_gathering_supreme_3333/resolve/main/replay.mp4"
  type="video/mp4">Your browser does not support the video tag.</video>"""
)
```

ä¸ºäº†åœ¨[è®¤è¯è¿‡ç¨‹](https://huggingface.co/deep-rl-course/en/unit0/introduction#certification-process)ä¸­éªŒè¯è¿™ä¸ªå®è·µç»ƒä¹ ï¼Œä½ éœ€è¦æ¨é€ä¸€ä¸ªæ¨¡å‹ï¼š

- `doom_health_gathering_supreme` è·å¾— >= 5 çš„ç»“æœã€‚

è¦æŸ¥æ‰¾ä½ çš„ç»“æœï¼Œè¯·å‰å¾€[æ’è¡Œæ¦œ](https://huggingface.co/spaces/huggingface-projects/Deep-Reinforcement-Learning-Leaderboard)å¹¶æ‰¾åˆ°ä½ çš„æ¨¡å‹ï¼Œ**ç»“æœ = å¹³å‡å¥–åŠ± - å¥–åŠ±çš„æ ‡å‡†å·®**

å¦‚æœä½ æ‰¾ä¸åˆ°ä½ çš„æ¨¡å‹ï¼Œ**è¯·è½¬åˆ°é¡µé¢åº•éƒ¨å¹¶ç‚¹å‡»åˆ·æ–°æŒ‰é’®**

æœ‰å…³è®¤è¯è¿‡ç¨‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤éƒ¨åˆ† ğŸ‘‰ https://huggingface.co/deep-rl-course/en/unit0/introduction#certification-process

## è®¾ç½®GPU ğŸ’ª

- ä¸ºäº†**åŠ é€Ÿæ™ºèƒ½ä½“çš„è®­ç»ƒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨GPU**ã€‚ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°`Runtime > Change Runtime type`

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/notebooks/gpu-step1.jpg" alt="GPU Step 1" />

- `Hardware Accelerator > GPU`

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/notebooks/gpu-step2.jpg" alt="GPU Step 2" />

åœ¨å¼€å§‹è®­ç»ƒæˆ‘ä»¬çš„æ™ºèƒ½ä½“ä¹‹å‰ï¼Œè®©æˆ‘ä»¬**ç ”ç©¶ä¸€ä¸‹æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„åº“å’Œç¯å¢ƒ**ã€‚

## Sample Factory

[Sample Factory](https://www.samplefactory.dev/)æ˜¯**æœ€å¿«çš„å¼ºåŒ–å­¦ä¹ åº“ä¹‹ä¸€ï¼Œä¸“æ³¨äºç­–ç•¥æ¢¯åº¦ï¼ˆPPOï¼‰çš„é«˜æ•ˆåŒæ­¥å’Œå¼‚æ­¥å®ç°**ã€‚

Sample Factoryç»è¿‡**å……åˆ†æµ‹è¯•ï¼Œè¢«è®¸å¤šç ”ç©¶äººå‘˜å’Œå®è·µè€…ä½¿ç”¨**ï¼Œå¹¶ä¸”å¾—åˆ°ç§¯æç»´æŠ¤ã€‚æˆ‘ä»¬çš„å®ç°**åœ¨å„ç§é¢†åŸŸéƒ½èƒ½è¾¾åˆ°æœ€å…ˆè¿›çš„æ€§èƒ½ï¼ŒåŒæ—¶æœ€å°åŒ–å¼ºåŒ–å­¦ä¹ å®éªŒçš„è®­ç»ƒæ—¶é—´å’Œç¡¬ä»¶éœ€æ±‚**ã€‚

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit9/samplefactoryenvs.png" alt="Sample factory"/>

### ä¸»è¦ç‰¹ç‚¹

- é«˜åº¦ä¼˜åŒ–çš„ç®—æ³•[æ¶æ„](https://www.samplefactory.dev/06-architecture/overview/)ï¼Œå®ç°æœ€å¤§å­¦ä¹ ååé‡
- [åŒæ­¥å’Œå¼‚æ­¥](https://www.samplefactory.dev/07-advanced-topics/sync-async/)è®­ç»ƒæ¨¡å¼
- [ä¸²è¡Œï¼ˆå•è¿›ç¨‹ï¼‰æ¨¡å¼](https://www.samplefactory.dev/07-advanced-topics/serial-mode/)ä¾¿äºè°ƒè¯•
- åœ¨åŸºäºCPUå’Œ[GPUåŠ é€Ÿç¯å¢ƒ](https://www.samplefactory.dev/09-environment-integrations/isaacgym/)ä¸­éƒ½èƒ½è¾¾åˆ°æœ€ä½³æ€§èƒ½
- å•æ™ºèƒ½ä½“å’Œå¤šæ™ºèƒ½ä½“è®­ç»ƒã€è‡ªæˆ‘å¯¹å¼ˆã€æ”¯æŒåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªGPUä¸Š[åŒæ—¶è®­ç»ƒå¤šä¸ªç­–ç•¥](https://www.samplefactory.dev/07-advanced-topics/multi-policy-training/)
- åŸºäºç§ç¾¤çš„è®­ç»ƒï¼ˆ[PBT](https://www.samplefactory.dev/07-advanced-topics/pbt/)ï¼‰
- ç¦»æ•£ã€è¿ç»­ã€æ··åˆåŠ¨ä½œç©ºé—´
- åŸºäºå‘é‡ã€åŸºäºå›¾åƒã€å­—å…¸è§‚å¯Ÿç©ºé—´
- é€šè¿‡è§£æåŠ¨ä½œ/è§‚å¯Ÿç©ºé—´è§„èŒƒè‡ªåŠ¨åˆ›å»ºæ¨¡å‹æ¶æ„ã€‚æ”¯æŒ[è‡ªå®šä¹‰æ¨¡å‹æ¶æ„](https://www.samplefactory.dev/03-customization/custom-models/)
- è®¾è®¡ä¸ºå¯å¯¼å…¥åˆ°å…¶ä»–é¡¹ç›®ä¸­ï¼Œ[è‡ªå®šä¹‰ç¯å¢ƒ](https://www.samplefactory.dev/03-customization/custom-environments/)æ˜¯ä¸€ç­‰å…¬æ°‘
- è¯¦ç»†çš„[WandBå’ŒTensorboardæ‘˜è¦](https://www.samplefactory.dev/05-monitoring/metrics-reference/)ï¼Œ[è‡ªå®šä¹‰æŒ‡æ ‡](https://www.samplefactory.dev/05-monitoring/custom-metrics/)
- [HuggingFace ğŸ¤— é›†æˆ](https://www.samplefactory.dev/10-huggingface/huggingface/)ï¼ˆå°†è®­ç»ƒå¥½çš„æ¨¡å‹å’ŒæŒ‡æ ‡ä¸Šä¼ åˆ°Hubï¼‰
- [å¤šä¸ª](https://www.samplefactory.dev/09-environment-integrations/mujoco/)[ç¤ºä¾‹](https://www.samplefactory.dev/09-environment-integrations/atari/)[ç¯å¢ƒ](https://www.samplefactory.dev/09-environment-integrations/vizdoom/)[é›†æˆ](https://www.samplefactory.dev/09-environment-integrations/dmlab/)ï¼Œå¸¦æœ‰è°ƒä¼˜å‚æ•°å’Œè®­ç»ƒå¥½çš„æ¨¡å‹

ä»¥ä¸Šæ‰€æœ‰ç­–ç•¥éƒ½å¯åœ¨ğŸ¤— hubä¸Šè·å–ã€‚æœç´¢æ ‡ç­¾[sample-factory](https://huggingface.co/models?library=sample-factory&sort=downloads)

### Sample-factoryå¦‚ä½•å·¥ä½œ

Sample-factoryæ˜¯**ç¤¾åŒºå¯ç”¨çš„æœ€é«˜åº¦ä¼˜åŒ–çš„å¼ºåŒ–å­¦ä¹ å®ç°ä¹‹ä¸€**ã€‚

å®ƒé€šè¿‡**ç”Ÿæˆå¤šä¸ªè¿›ç¨‹æ¥è¿è¡Œrolloutå·¥ä½œå™¨ã€æ¨ç†å·¥ä½œå™¨å’Œå­¦ä¹ å·¥ä½œå™¨**ã€‚

è¿™äº›*å·¥ä½œå™¨***é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œè¿™é™ä½äº†è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æˆæœ¬**ã€‚

*rolloutå·¥ä½œå™¨*ä¸ç¯å¢ƒäº¤äº’å¹¶å°†è§‚å¯Ÿç»“æœå‘é€ç»™*æ¨ç†å·¥ä½œå™¨*ã€‚

*æ¨ç†å·¥ä½œå™¨*æŸ¥è¯¢ç­–ç•¥çš„å›ºå®šç‰ˆæœ¬å¹¶**å°†åŠ¨ä½œå‘é€å›rolloutå·¥ä½œå™¨**ã€‚

åœ¨*k*æ­¥ä¹‹åï¼Œrolloutå·¥ä½œå™¨å°†ç»éªŒè½¨è¿¹å‘é€ç»™å­¦ä¹ å·¥ä½œå™¨ï¼Œ**å­¦ä¹ å·¥ä½œå™¨ä½¿ç”¨è¿™äº›ç»éªŒæ¥æ›´æ–°æ™ºèƒ½ä½“çš„ç­–ç•¥ç½‘ç»œ**ã€‚

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit9/samplefactory.png" alt="Sample factory"/>

### Sample-factoryä¸­çš„Actor Criticæ¨¡å‹

Sample Factoryä¸­çš„Actor Criticæ¨¡å‹ç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼š

- **ç¼–ç å™¨ï¼ˆEncoderï¼‰** - å¤„ç†è¾“å…¥è§‚å¯Ÿï¼ˆå›¾åƒã€å‘é‡ï¼‰å¹¶å°†å…¶æ˜ å°„åˆ°å‘é‡ã€‚è¿™æ˜¯ä½ æœ€å¯èƒ½æƒ³è¦è‡ªå®šä¹‰çš„æ¨¡å‹éƒ¨åˆ†ã€‚
- **æ ¸å¿ƒï¼ˆCoreï¼‰** - æ•´åˆæ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªç¼–ç å™¨çš„å‘é‡ï¼Œå¯ä»¥é€‰æ‹©åœ¨åŸºäºè®°å¿†çš„æ™ºèƒ½ä½“ä¸­åŒ…å«å•å±‚æˆ–å¤šå±‚LSTM/GRUã€‚
- **è§£ç å™¨ï¼ˆDecoderï¼‰** - åœ¨è®¡ç®—ç­–ç•¥å’Œä»·å€¼è¾“å‡ºä¹‹å‰ï¼Œå¯¹æ¨¡å‹æ ¸å¿ƒçš„è¾“å‡ºåº”ç”¨é¢å¤–çš„å±‚ã€‚

è¯¥åº“è¢«è®¾è®¡ä¸ºè‡ªåŠ¨æ”¯æŒä»»ä½•è§‚å¯Ÿå’ŒåŠ¨ä½œç©ºé—´ã€‚ç”¨æˆ·å¯ä»¥è½»æ¾æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹ã€‚ä½ å¯ä»¥åœ¨[æ–‡æ¡£](https://www.samplefactory.dev/03-customization/custom-models/#actor-critic-models-in-sample-factory)ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚

## ViZDoom

[ViZDoom](https://vizdoom.cs.put.edu.pl/)æ˜¯**Doomå¼•æ“çš„ä¸€ä¸ªå¼€æºPythonæ¥å£**ã€‚

è¯¥åº“ç”±æ³¢å…¹å—ç†å·¥å¤§å­¦è®¡ç®—æœºç§‘å­¦ç ”ç©¶æ‰€çš„Marek Wydmuchå’ŒMichal Kempkaäº2016å¹´åˆ›å»ºã€‚

è¯¥åº“**æ”¯æŒåœ¨å¤šç§åœºæ™¯ä¸­ç›´æ¥ä»å±å¹•åƒç´ è®­ç»ƒæ™ºèƒ½ä½“**ï¼ŒåŒ…æ‹¬å›¢é˜Ÿæ­»äº¡ç«èµ›ï¼Œå¦‚ä¸‹é¢çš„è§†é¢‘æ‰€ç¤ºã€‚ç”±äºViZDoomç¯å¢ƒåŸºäº90å¹´ä»£åˆ›å»ºçš„æ¸¸æˆï¼Œå®ƒå¯ä»¥åœ¨ç°ä»£ç¡¬ä»¶ä¸Šä»¥åŠ é€Ÿé€Ÿåº¦è¿è¡Œï¼Œ**ä½¿æˆ‘ä»¬èƒ½å¤Ÿç›¸å½“å¿«é€Ÿåœ°å­¦ä¹ å¤æ‚çš„AIè¡Œä¸º**ã€‚

è¯¥åº“åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š

- å¤šå¹³å°ï¼ˆLinuxã€macOSã€Windowsï¼‰
- Pythonå’ŒC++çš„API
- [OpenAI Gym](https://www.gymlibrary.dev/)ç¯å¢ƒåŒ…è£…å™¨
- æ˜“äºåˆ›å»ºè‡ªå®šä¹‰åœºæ™¯ï¼ˆæä¾›å¯è§†åŒ–ç¼–è¾‘å™¨ã€è„šæœ¬è¯­è¨€å’Œç¤ºä¾‹ï¼‰
- å¼‚æ­¥å’ŒåŒæ­¥çš„å•äººå’Œå¤šäººæ¨¡å¼
- è½»é‡çº§ï¼ˆå‡ MBï¼‰ä¸”å¿«é€Ÿï¼ˆåœ¨åŒæ­¥æ¨¡å¼ä¸‹ï¼Œå•çº¿ç¨‹å¯è¾¾7000 fpsï¼‰
- å¯è‡ªå®šä¹‰çš„åˆ†è¾¨ç‡å’Œæ¸²æŸ“å‚æ•°
- è®¿é—®æ·±åº¦ç¼“å†²åŒºï¼ˆ3Dè§†è§‰ï¼‰
- è‡ªåŠ¨æ ‡è®°å¸§ä¸­å¯è§çš„æ¸¸æˆå¯¹è±¡
- è®¿é—®éŸ³é¢‘ç¼“å†²åŒº
- è®¿é—®è§’è‰²/å¯¹è±¡åˆ—è¡¨å’Œåœ°å›¾å‡ ä½•
- ç¦»å±æ¸²æŸ“å’Œæƒ…èŠ‚è®°å½•
- å¼‚æ­¥æ¨¡å¼ä¸‹çš„æ—¶é—´ç¼©æ”¾

## æˆ‘ä»¬é¦–å…ˆéœ€è¦å®‰è£…ViZDoomç¯å¢ƒæ‰€éœ€çš„ä¸€äº›ä¾èµ–é¡¹

ç°åœ¨æˆ‘ä»¬çš„Colabè¿è¡Œæ—¶å·²ç»è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å®‰è£…åœ¨Linuxä¸Šè¿è¡ŒViZDoomæ‰€éœ€çš„ä¾èµ–é¡¹ã€‚

å¦‚æœä½ åœ¨Macä¸Šçš„æœºå™¨ä¸Šè·Ÿè¿›ï¼Œä½ éœ€è¦æŒ‰ç…§[githubé¡µé¢](https://github.com/Farama-Foundation/ViZDoom/blob/master/doc/Quickstart.md#-quickstart-for-macos-and-anaconda3-python-36)ä¸Šçš„å®‰è£…è¯´æ˜è¿›è¡Œæ“ä½œã€‚

```python
# Install ViZDoom deps from
# https://github.com/mwydmuch/ViZDoom/blob/master/doc/Building.md#-linux

apt-get install build-essential zlib1g-dev libsdl2-dev libjpeg-dev \
nasm tar libbz2-dev libgtk2.0-dev cmake git libfluidsynth-dev libgme-dev \
libopenal-dev timidity libwildmidi-dev unzip ffmpeg

# Boost libraries
apt-get install libboost-all-dev

# Lua binding dependencies
apt-get install liblua5.1-dev
```

## Then we can install Sample Factory and ViZDoom

- This can take 7min

```bash
pip install sample-factory
pip install vizdoom
```

## Setting up the Doom Environment in sample-factory

```python
import functools

from sample_factory.algo.utils.context import global_model_factory
from sample_factory.cfg.arguments import parse_full_cfg, parse_sf_args
from sample_factory.envs.env_utils import register_env
from sample_factory.train import run_rl

from sf_examples.vizdoom.doom.doom_model import make_vizdoom_encoder
from sf_examples.vizdoom.doom.doom_params import add_doom_env_args, doom_override_defaults
from sf_examples.vizdoom.doom.doom_utils import DOOM_ENVS, make_doom_env_from_spec


# Registers all the ViZDoom environments
def register_vizdoom_envs():
    for env_spec in DOOM_ENVS:
        make_env_func = functools.partial(make_doom_env_from_spec, env_spec)
        register_env(env_spec.name, make_env_func)


# Sample Factory allows the registration of a custom Neural Network architecture
# See https://github.com/alex-petrenko/sample-factory/blob/master/sf_examples/vizdoom/doom/doom_model.py for more details
def register_vizdoom_models():
    global_model_factory().register_encoder_factory(make_vizdoom_encoder)


def register_vizdoom_components():
    register_vizdoom_envs()
    register_vizdoom_models()


# parse the command line args and create a config
def parse_vizdoom_cfg(argv=None, evaluation=False):
    parser, _ = parse_sf_args(argv=argv, evaluation=evaluation)
    # parameters specific to Doom envs
    add_doom_env_args(parser)
    # override Doom default values for algo parameters
    doom_override_defaults(parser)
    # second parsing pass yields the final configuration
    final_cfg = parse_full_cfg(parser, argv)
    return final_cfg
```

ç°åœ¨è®¾ç½®å·²ç»å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥è®­ç»ƒæ™ºèƒ½ä½“äº†ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©å­¦ä¹ ä¸€ä¸ªåä¸º`Health Gathering Supreme`çš„ViZDoomä»»åŠ¡ã€‚

### åœºæ™¯ï¼šHealth Gathering Supremeï¼ˆå¥åº·æ”¶é›†è‡³å°Šç‰ˆï¼‰

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit9/Health-Gathering-Supreme.png" alt="Health-Gathering-Supreme"/>



è¿™ä¸ªåœºæ™¯çš„ç›®æ ‡æ˜¯**æ•™ä¼šæ™ºèƒ½ä½“å¦‚ä½•åœ¨ä¸çŸ¥é“ä»€ä¹ˆèƒ½è®©å®ƒç”Ÿå­˜çš„æƒ…å†µä¸‹ç”Ÿå­˜**ã€‚æ™ºèƒ½ä½“åªçŸ¥é“**ç”Ÿå‘½æ˜¯å®è´µçš„**ï¼Œæ­»äº¡æ˜¯ä¸å¥½çš„ï¼Œæ‰€ä»¥**å®ƒå¿…é¡»å­¦ä¹ ä»€ä¹ˆèƒ½å»¶é•¿å®ƒçš„å­˜åœ¨ï¼Œä»¥åŠå®ƒçš„å¥åº·ä¸ç”Ÿå­˜æ˜¯ç›¸è¿çš„**ã€‚

åœ°å›¾æ˜¯ä¸€ä¸ªåŒ…å«å¢™å£çš„çŸ©å½¢ï¼Œåœ°é¢æ˜¯ç»¿è‰²çš„é…¸æ€§åœ°æ¿ï¼Œ**ä¼šå®šæœŸä¼¤å®³ç©å®¶**ã€‚æœ€åˆï¼Œåœ°å›¾ä¸Šå‡åŒ€åˆ†å¸ƒç€ä¸€äº›åŒ»ç–—åŒ…ã€‚æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œä¸€ä¸ªæ–°çš„åŒ»ç–—åŒ…ä¼šä»å¤©ç©ºæ‰è½ã€‚**åŒ»ç–—åŒ…å¯ä»¥æ¢å¤ç©å®¶å¥åº·çš„ä¸€éƒ¨åˆ†**â€”â€”ä¸ºäº†ç”Ÿå­˜ï¼Œæ™ºèƒ½ä½“éœ€è¦æ‹¾å–å®ƒä»¬ã€‚åœ¨ç©å®¶æ­»äº¡æˆ–è¶…æ—¶åï¼Œå›åˆç»“æŸã€‚

è¿›ä¸€æ­¥é…ç½®ï¼š
- ç”Ÿå­˜å¥–åŠ± = 1
- 3ä¸ªå¯ç”¨æŒ‰é’®ï¼šå‘å·¦è½¬ï¼Œå‘å³è½¬ï¼Œå‘å‰ç§»åŠ¨
- 1ä¸ªå¯ç”¨æ¸¸æˆå˜é‡ï¼šHEALTHï¼ˆå¥åº·å€¼ï¼‰
- æ­»äº¡æƒ©ç½š = 100

ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/Farama-Foundation/ViZDoom/tree/master/scenarios)äº†è§£æ›´å¤šå…³äºViZDoomä¸­å¯ç”¨åœºæ™¯çš„ä¿¡æ¯ã€‚

è¿˜æœ‰ä¸€äº›ä¸ºViZDoomåˆ›å»ºçš„æ›´å¤æ‚çš„åœºæ™¯ï¼Œæ¯”å¦‚[è¿™ä¸ªgithubé¡µé¢](https://github.com/edbeeching/3d_control_deep_rl)ä¸Šè¯¦è¿°çš„åœºæ™¯ã€‚



## è®­ç»ƒæ™ºèƒ½ä½“

- æˆ‘ä»¬å°†è®­ç»ƒæ™ºèƒ½ä½“4000000æ­¥ã€‚è¿™å°†èŠ±è´¹å¤§çº¦20åˆ†é’Ÿ

```python
## Start the training, this should take around 15 minutes
register_vizdoom_components()

# The scenario we train on today is health gathering
# other scenarios include "doom_basic", "doom_two_colors_easy", "doom_dm", "doom_dwango5", "doom_my_way_home", "doom_deadly_corridor", "doom_defend_the_center", "doom_defend_the_line"
env = "doom_health_gathering_supreme"
cfg = parse_vizdoom_cfg(
    argv=[f"--env={env}", "--num_workers=8", "--num_envs_per_worker=4", "--train_for_env_steps=4000000"]
)

status = run_rl(cfg)
```

## è®©æˆ‘ä»¬çœ‹çœ‹è®­ç»ƒå¥½çš„ç­–ç•¥çš„è¡¨ç°å¹¶è¾“å‡ºæ™ºèƒ½ä½“çš„è§†é¢‘

```python
from sample_factory.enjoy import enjoy

cfg = parse_vizdoom_cfg(
    argv=[f"--env={env}", "--num_workers=1", "--save_video", "--no_render", "--max_num_episodes=10"], evaluation=True
)
status = enjoy(cfg)
```

## ç°åœ¨è®©æˆ‘ä»¬å¯è§†åŒ–æ™ºèƒ½ä½“çš„è¡¨ç°

```python
from base64 import b64encode
from IPython.display import HTML

mp4 = open("/content/train_dir/default_experiment/replay.mp4", "rb").read()
data_url = "data:video/mp4;base64," + b64encode(mp4).decode()
HTML(
    """
<video width=640 controls>
      <source src="%s" type="video/mp4">
</video>
"""
    % data_url
)
```

æ™ºèƒ½ä½“å·²ç»å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œä½†å®ƒçš„è¡¨ç°å¯ä»¥æ›´å¥½ã€‚æˆ‘ä»¬æ˜¾ç„¶éœ€è¦è®­ç»ƒæ›´é•¿æ—¶é—´ã€‚ä½†è®©æˆ‘ä»¬å…ˆå°†è¿™ä¸ªæ¨¡å‹ä¸Šä¼ åˆ°Hubã€‚

## ç°åœ¨è®©æˆ‘ä»¬å°†ä½ çš„æ£€æŸ¥ç‚¹å’Œè§†é¢‘ä¸Šä¼ åˆ°Hugging Face Hub




è¦èƒ½å¤Ÿä¸ç¤¾åŒºåˆ†äº«ä½ çš„æ¨¡å‹ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ­¥éª¤éœ€è¦éµå¾ªï¼š

1ï¸âƒ£ ï¼ˆå¦‚æœè¿˜æ²¡æœ‰å®Œæˆï¼‰åˆ›å»ºä¸€ä¸ªHFè´¦æˆ· â¡ https://huggingface.co/join

2ï¸âƒ£ ç™»å½•å¹¶ä»Hugging Faceç½‘ç«™è·å–ä½ çš„è®¤è¯ä»¤ç‰Œã€‚
- åˆ›å»ºä¸€ä¸ªæ–°ä»¤ç‰Œï¼ˆhttps://huggingface.co/settings/tokensï¼‰**å…·æœ‰å†™å…¥æƒé™**

<img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/notebooks/create-token.jpg" alt="Create HF Token" />

- å¤åˆ¶ä»¤ç‰Œ
- è¿è¡Œä¸‹é¢çš„å•å…ƒæ ¼å¹¶ç²˜è´´ä»¤ç‰Œ

å¦‚æœä½ ä¸æƒ³ä½¿ç”¨Google Colabæˆ–Jupyter Notebookï¼Œä½ éœ€è¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ä»£æ›¿ï¼š`huggingface-cli login`

```python
from huggingface_hub import notebook_login
notebook_login()
!git config --global credential.helper store
```

```python
from sample_factory.enjoy import enjoy

hf_username = "ThomasSimonini"  # insert your HuggingFace username here

cfg = parse_vizdoom_cfg(
    argv=[
        f"--env={env}",
        "--num_workers=1",
        "--save_video",
        "--no_render",
        "--max_num_episodes=10",
        "--max_num_frames=100000",
        "--push_to_hub",
        f"--hf_repository={hf_username}/rl_course_vizdoom_health_gathering_supreme",
    ],
    evaluation=True,
)
status = enjoy(cfg)
```

## è®©æˆ‘ä»¬åŠ è½½å¦ä¸€ä¸ªæ¨¡å‹




è¿™ä¸ªæ™ºèƒ½ä½“çš„è¡¨ç°å¾ˆå¥½ï¼Œä½†æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼è®©æˆ‘ä»¬ä»hubä¸‹è½½å¹¶å¯è§†åŒ–ä¸€ä¸ªç»è¿‡10Bæ—¶é—´æ­¥è®­ç»ƒçš„æ™ºèƒ½ä½“ã€‚

```bash
#download the agent from the hub
python -m sample_factory.huggingface.load_from_hub -r edbeeching/doom_health_gathering_supreme_2222 -d ./train_dir
```

```bash
ls train_dir/doom_health_gathering_supreme_2222
```

```python
env = "doom_health_gathering_supreme"
cfg = parse_vizdoom_cfg(
    argv=[
        f"--env={env}",
        "--num_workers=1",
        "--save_video",
        "--no_render",
        "--max_num_episodes=10",
        "--experiment=doom_health_gathering_supreme_2222",
        "--train_dir=train_dir",
    ],
    evaluation=True,
)
status = enjoy(cfg)
```

```python
mp4 = open("/content/train_dir/doom_health_gathering_supreme_2222/replay.mp4", "rb").read()
data_url = "data:video/mp4;base64," + b64encode(mp4).decode()
HTML(
    """
<video width=640 controls>
      <source src="%s" type="video/mp4">
</video>
"""
    % data_url
)
```

## ä¸€äº›é¢å¤–çš„æŒ‘æˆ˜ ğŸ†ï¼šDoomæ­»äº¡ç«èµ›

è®­ç»ƒä¸€ä¸ªæ™ºèƒ½ä½“ç©Doomæ­»äº¡ç«èµ›**éœ€è¦åœ¨æ¯”Colabæ›´å¼ºå¤§çš„æœºå™¨ä¸ŠèŠ±è´¹å¾ˆå¤šå°æ—¶**ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬**å·²ç»åœ¨è¿™ä¸ªåœºæ™¯ä¸­è®­ç»ƒäº†ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œå®ƒå¯ä»¥åœ¨ğŸ¤— Hubä¸Šè·å–ï¼**è®©æˆ‘ä»¬ä¸‹è½½æ¨¡å‹å¹¶å¯è§†åŒ–æ™ºèƒ½ä½“çš„è¡¨ç°ã€‚

```python
# ä»Hubä¸‹è½½æ™ºèƒ½ä½“
python -m sample_factory.huggingface.load_from_hub -r edbeeching/doom_deathmatch_bots_2222 -d ./train_dir
```

ç”±äºæ™ºèƒ½ä½“éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œè§†é¢‘ç”Ÿæˆå¯èƒ½éœ€è¦**10åˆ†é’Ÿ**ã€‚

```python
from sample_factory.enjoy import enjoy

register_vizdoom_components()
env = "doom_deathmatch_bots"
cfg = parse_vizdoom_cfg(
    argv=[
        f"--env={env}",
        "--num_workers=1",
        "--save_video",
        "--no_render",
        "--max_num_episodes=1",
        "--experiment=doom_deathmatch_bots_2222",
        "--train_dir=train_dir",
    ],
    evaluation=True,
)
status = enjoy(cfg)
mp4 = open("/content/train_dir/doom_deathmatch_bots_2222/replay.mp4", "rb").read()
data_url = "data:video/mp4;base64," + b64encode(mp4).decode()
HTML(
    """
<video width=640 controls>
      <source src="%s" type="video/mp4">
</video>
"""
    % data_url
)
```


ä½ **å¯ä»¥å°è¯•åœ¨è¿™ä¸ªç¯å¢ƒä¸­è®­ç»ƒä½ çš„æ™ºèƒ½ä½“**ï¼Œä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œä½†ä¸æ˜¯åœ¨colabä¸Šã€‚
**ç¥ä½ å¥½è¿ ğŸ¤**

å¦‚æœä½ æ›´å–œæ¬¢ç®€å•ä¸€ç‚¹çš„åœºæ™¯ï¼Œ**ä¸ºä»€ä¹ˆä¸å°è¯•åœ¨å…¶ä»–ViZDoomåœºæ™¯ä¸­è®­ç»ƒï¼Œæ¯”å¦‚`doom_deadly_corridor`æˆ–`doom_defend_the_center`ã€‚**



---


è¿™å°±ç»“æŸäº†æœ€åä¸€ä¸ªå•å…ƒã€‚ä½†æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆï¼ğŸ¤— æ¥ä¸‹æ¥çš„**å¥–åŠ±éƒ¨åˆ†åŒ…å«äº†æ·±åº¦å¼ºåŒ–å­¦ä¹ ä¸­ä¸€äº›æœ€æœ‰è¶£ã€æœ€å…ˆè¿›å’Œæœ€å‰æ²¿çš„å·¥ä½œ**ã€‚

## æŒç»­å­¦ä¹ ï¼Œä¿æŒç²¾å½© ğŸ¤—
